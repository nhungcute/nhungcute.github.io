<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Gửi dữ liệu vào Google Sheets bằng OAuth</title>
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
  <h2>Gửi dữ liệu vào Google Sheets bằng Google Sheets API</h2>
  <button onclick="handleAuthClick()">🔐 Đăng nhập</button>
  <button onclick="appendData()">📤 Gửi dữ liệu</button>

  <script>
    const CLIENT_ID = 'PASTE_YOUR_CLIENT_ID_HERE.apps.googleusercontent.com';
    const API_KEY = 'PASTE_YOUR_API_KEY_HERE';
    const SPREADSHEET_ID = 'PASTE_YOUR_SPREADSHEET_ID_HERE';
    const SCOPE = 'https://www.googleapis.com/auth/spreadsheets';

    // 1️⃣ Tải Google API và khởi tạo client
    function initApiClient() {
      return gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
        scope: SCOPE
      });
    }

    // 2️⃣ Bắt đầu khi trang tải xong
    function start() {
      gapi.load('client:auth2', () => {
        initApiClient().then(() => {
          console.log('✅ GAPI client đã sẵn sàng');
        });
      });
    }

    window.onload = start;

    // 3️⃣ Đăng nhập với OAuth2
    function handleAuthClick() {
      gapi.auth2.getAuthInstance().signIn().then(() => {
        console.log("🔐 Đã xác thực người dùng");
      });
    }

    // 4️⃣ Gửi dữ liệu vào Google Sheets
    function appendData() {
      if (!gapi.client.sheets) {
        alert("Google Sheets API chưa sẵn sàng. Hãy thử lại sau khi xác thực.");
        return;
      }

      const values = [
        ["Tên", "Email", "Thời gian"],
        ["Mạnh", "manh@example.com", new Date().toLocaleString()]
      ];

      const params = {
        spreadsheetId: SPREADSHEET_ID,
        range: 'Sheet1!A1',
        valueInputOption: 'USER_ENTERED',
        insertDataOption: 'INSERT_ROWS'
      };

      const body = {
        values: values
      };

      gapi.client.sheets.spreadsheets.values.append(params, body).then(response => {
        console.log("📄 Dữ liệu đã ghi:", response);
        alert("🎉 Gửi dữ liệu thành công!");
      }, error => {
        console.error("❌ Lỗi ghi dữ liệu:", error);
        alert("Lỗi gửi dữ liệu. Xem console để biết thêm chi tiết.");
      });
    }
  </script>
</body>
</html>
