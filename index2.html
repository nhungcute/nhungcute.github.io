<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Gá»­i dá»¯ liá»‡u vÃ o Google Sheets báº±ng OAuth</title>
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
  <h2>Gá»­i dá»¯ liá»‡u vÃ o Google Sheets báº±ng Google Sheets API</h2>
  <button onclick="handleAuthClick()">ğŸ” ÄÄƒng nháº­p</button>
  <button onclick="appendData()">ğŸ“¤ Gá»­i dá»¯ liá»‡u</button>

  <script>
    const CLIENT_ID = 'PASTE_YOUR_CLIENT_ID_HERE.apps.googleusercontent.com';
    const API_KEY = 'PASTE_YOUR_API_KEY_HERE';
    const SPREADSHEET_ID = 'PASTE_YOUR_SPREADSHEET_ID_HERE';
    const SCOPE = 'https://www.googleapis.com/auth/spreadsheets';

    // 1ï¸âƒ£ Táº£i Google API vÃ  khá»Ÿi táº¡o client
    function initApiClient() {
      return gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
        scope: SCOPE
      });
    }

    // 2ï¸âƒ£ Báº¯t Ä‘áº§u khi trang táº£i xong
    function start() {
      gapi.load('client:auth2', () => {
        initApiClient().then(() => {
          console.log('âœ… GAPI client Ä‘Ã£ sáºµn sÃ ng');
        });
      });
    }

    window.onload = start;

    // 3ï¸âƒ£ ÄÄƒng nháº­p vá»›i OAuth2
    function handleAuthClick() {
      gapi.auth2.getAuthInstance().signIn().then(() => {
        console.log("ğŸ” ÄÃ£ xÃ¡c thá»±c ngÆ°á»i dÃ¹ng");
      });
    }

    // 4ï¸âƒ£ Gá»­i dá»¯ liá»‡u vÃ o Google Sheets
    function appendData() {
      if (!gapi.client.sheets) {
        alert("Google Sheets API chÆ°a sáºµn sÃ ng. HÃ£y thá»­ láº¡i sau khi xÃ¡c thá»±c.");
        return;
      }

      const values = [
        ["TÃªn", "Email", "Thá»i gian"],
        ["Máº¡nh", "manh@example.com", new Date().toLocaleString()]
      ];

      const params = {
        spreadsheetId: SPREADSHEET_ID,
        range: 'Sheet1!A1',
        valueInputOption: 'USER_ENTERED',
        insertDataOption: 'INSERT_ROWS'
      };

      const body = {
        values: values
      };

      gapi.client.sheets.spreadsheets.values.append(params, body).then(response => {
        console.log("ğŸ“„ Dá»¯ liá»‡u Ä‘Ã£ ghi:", response);
        alert("ğŸ‰ Gá»­i dá»¯ liá»‡u thÃ nh cÃ´ng!");
      }, error => {
        console.error("âŒ Lá»—i ghi dá»¯ liá»‡u:", error);
        alert("Lá»—i gá»­i dá»¯ liá»‡u. Xem console Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t.");
      });
    }
  </script>
</body>
</html>
